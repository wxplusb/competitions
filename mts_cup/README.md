## MTS ML CUP 2023

### Задача

Определение пола и возраста владельца HTTP cookie по истории активности пользователя в интернете на основе синтетических данных.

- Датасет состоял из 322 млн. образцов. 
- Каждый образец представлял собой заход пользователя на какой-то сайт и нес информацию: модель, тип и стоимость телефона, дата и время захода, регион, город, адрес сайта. 
- По каждому пользователю было от 1 до свыше 10000 образцов. 
- 270 тыс пользователей в трейне, 144 тыс в тесте.

Метрика соревнования: gini – для определения пола, f1 weighted – для определения возраста по формуле:  2 * f1_weighted(по 6 возрастным бакетам) + gini по полу.

[ODS](https://ods.ai/competitions/mtsmlcup)
[Habr](https://habr.com/ru/companies/ru_mts/articles/709602/)

### Решение

Было протестировано 2 подхода:
1. Извлекались эмбеддинги последовательностей с помощью Contrastive Learning for Event Sequences ([CoLES](https://arxiv.org/abs/2002.08232)) и библиотеки ([pytorch-lifestream](https://github.com/dllllb/pytorch-lifestream)) и на них тренировался catboost.
2. Supervised подход с 2-слойной GRU, Noise Embeddings для каждого признака в образце. Из-за большой разницы в длине последовательностей (от 1 до 10000) для минимизации паддингов и увеличения эффективности была применена техника sequence bucketing, когда последовательности группируются по длине в бакеты и из бакетов уже извлекаются батчи. Использовались аугментации в виде перемешивания последовательностей и слайсинга подпоследовательностей. Этот подход показал наилучший результат и представлен в этом репозитории. 


Файлы:
1. [1_prepro.ipynb](1_prepro.ipynb) - объединение данных, заполнение пропусков, распределение цен телефонов по бинам, ordinal encoding категориальных признаков для передачи в эмбеддинги, создание удобных для дальнейшей тренировки структур в виде вложенных словарей 'user_id' => словарь с тензорами.
2. [2_train_predict_age.ipynb](2_train_predict_age.ipynb) - тренировка модели для предсказания возраста юзера 
3. [3_train_predict_is_male.ipynb](3_train_predict_is_male.ipynb) - тренировка модели для предсказания пола юзера 

### Результат:

```
28 место (топ 10%)
```